{{/* 单个Steam成就展示短代码 */}}
{{/* 使用方法: {{< steam_achievement name="achievement_name" file="data/steam_achievements_400_portal.json" >}} */}}

{{ $filePath := .Get "file" }}
{{ $achievements := false }}

{{ if $filePath }}
    {{/* 从完整路径提取文件名（不含扩展名） */}}
    {{ $fileName := replace (path.Base $filePath) ".json" "" }}
    {{ $achievements = index .Site.Data $fileName }}
{{ else }}
    {{ $achievements = .Site.Data.steam_achievements }}
{{ end }}

{{ $achievementName := .Get "name" }}
{{ $achievement := false }}

{{ if $achievements }}
    {{ range $achievements.achievements }}
        {{ if eq .name $achievementName }}
            {{ $achievement = . }}
        {{ end }}
    {{ end }}
{{ end }}

{{ if $achievement }}
<div class="steam-achievement-card {{ if eq $achievement.hidden 1 }}hidden-achievement{{ end }}">
    <div class="achievement-icon">
        <a href="{{ $achievement.steamUrl }}" target="_blank" rel="noopener">
            <img src="{{ $achievement.icon }}" alt="{{ $achievement.displayName }}" 
                 onerror="this.src='{{ $achievement.icongray }}'">
        </a>
    </div>
    
    <div class="achievement-content">
        <h4 class="achievement-title">
            <a href="{{ $achievement.steamUrl }}" target="_blank" rel="noopener">
                <span class="achievement-title-text" data-name-zh="{{ with $achievement.displayName_zh }}{{ . }}{{ else }}{{ $achievement.displayName }}{{ end }}" data-name-en="{{ with $achievement.displayName_en }}{{ . }}{{ else }}{{ $achievement.displayName }}{{ end }}">
                    {{ with $achievement.displayName_zh }}{{ . }}{{ else }}{{ $achievement.displayName }}{{ end }}
                </span>
            </a>
            {{ if eq $achievement.hidden 1 }}
                <span class="hidden-badge">隐藏</span>
            {{ end }}
        </h4>
        
        <p class="achievement-desc" data-desc-zh="{{ with $achievement.description_zh }}{{ . }}{{ else }}{{ $achievement.description }}{{ end }}" data-desc-en="{{ with $achievement.description_en }}{{ . }}{{ else }}{{ $achievement.description }}{{ end }}">{{ with $achievement.description_zh }}{{ . }}{{ else }}{{ $achievement.description }}{{ end }}</p>
        
        <a href="{{ $achievement.steamUrl }}" target="_blank" rel="noopener" class="steam-button">
            <i class="steam-icon"></i> Steam页面
        </a>
    </div>
</div>

<style>
.steam-achievement-card {
    display: flex;
    align-items: center;
    background: var(--bg-primary, white);
    border: 1px solid var(--border-light, #d6d9dc);
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
    transition: all 0.2s ease;
}

.steam-achievement-card:hover {
    border-color: var(--accent-color, #1b2838);
    box-shadow: 0 2px 8px var(--shadow-color, rgba(0,0,0,0.1));
}

.steam-achievement-card.hidden-achievement {
    background: var(--bg-tertiary, #f8f9fa);
    border-color: var(--border-secondary, #adb5bd);
}

.achievement-icon {
    margin-right: 1rem;
    flex-shrink: 0;
}

.achievement-icon img {
    width: 48px;
    height: 48px;
    border-radius: 4px;
}

.achievement-content {
    flex: 1;
}

.achievement-title {
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
    line-height: 1.3;
}

.achievement-title a {
    color: var(--text-primary, #1b2838);
    text-decoration: none;
}

.achievement-title a:hover {
    color: var(--link-hover, #66c0f4);
    text-decoration: underline;
}

.hidden-badge {
    display: inline-block;
    background: #ff6b6b;
    color: white;
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    margin-left: 0.5rem;
}

.achievement-desc {
    margin: 0 0 0.8rem 0;
    color: var(--text-secondary, #8f98a0);
    font-size: 0.9rem;
    line-height: 1.4;
}

.steam-button {
    display: inline-flex;
    align-items: center;
    color: var(--link-color, #66c0f4);
    text-decoration: none;
    font-size: 0.85rem;
    padding: 0.4rem 0.8rem;
    border: 1px solid var(--link-color, #66c0f4);
    border-radius: 4px;
    transition: all 0.2s ease;
}

.steam-button:hover {
    background: var(--link-color, #66c0f4);
    color: white;
}

.steam-icon {
    display: inline-block;
    width: 14px;
    height: 14px;
    margin-right: 0.4rem;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c5.52 0 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>') no-repeat center;
    background-size: contain;
}

/* 深色主题支持 */
@media (prefers-color-scheme: dark) {
    .steam-achievement-card {
        --bg-primary: #2d2d2d;
        --border-light: #444;
        --border-secondary: #555;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --accent-color: #66c0f4;
        --link-color: #66c0f4;
        --link-hover: #4a9fd1;
        --shadow-color: rgba(255,255,255,0.1);
        --bg-tertiary: #1a1a1a;
    }
}

/* 浅色主题支持 */
@media (prefers-color-scheme: light) {
    .steam-achievement-card {
        --bg-primary: white;
        --border-light: #d6d9dc;
        --border-secondary: #adb5bd;
        --text-primary: #171a21;
        --text-secondary: #8f98a0;
        --accent-color: #1b2838;
        --link-color: #66c0f4;
        --link-hover: #4a9fd1;
        --shadow-color: rgba(0,0,0,0.1);
        --bg-tertiary: #f8f9fa;
    }
}

/* 如果主题使用CSS类切换，支持类名方式 */
.theme-dark .steam-achievement-card {
    --bg-primary: #2d2d2d;
    --border-light: #444;
    --border-secondary: #555;
    --text-primary: #ffffff;
    --text-secondary: #b0b0b0;
    --accent-color: #66c0f4;
    --link-color: #66c0f4;
    --link-hover: #4a9fd1;
    --shadow-color: rgba(255,255,255,0.1);
    --bg-tertiary: #1a1a1a;
}

.theme-light .steam-achievement-card {
    --bg-primary: white;
    --border-light: #d6d9dc;
    --border-secondary: #adb5bd;
    --text-primary: #171a21;
    --text-secondary: #8f98a0;
    --accent-color: #1b2838;
    --link-color: #66c0f4;
    --link-hover: #4a9fd1;
    --shadow-color: rgba(0,0,0,0.1);
    --bg-tertiary: #f8f9fa;
}
</style>
{{ else }}
<div class="achievement-not-found">
    <p>成就 "{{ $achievementName }}" 未找到。</p>
</div>
{{ end }}
